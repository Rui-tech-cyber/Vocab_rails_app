<h1>単語検索</h1>

<%= form_with url: search_words_path, method: :get, local: true do %>
  <div class="mb-3">
    <%= label_tag :term, "検索ワード" %>
    <%= text_field_tag :term, params[:term], class: "form-control" %>
  </div>
  <%= submit_tag "検索", class: "btn btn-primary" %>
<% end %>

<% if flash.now[:alert].present? %>
  <div class="alert alert-warning">
    <%= flash.now[:alert] %>
  </div>
<% end %>

<% if @results.present? %>
  <h2>検索結果</h2>
  <ul>
    <% @results.each do |entry| %>
      <li>
        <strong><%= entry[:word] %></strong>: <%= entry[:meaning] %>
        <% if entry[:example].present? %>
          <br>例文: <%= entry[:example] %>
        <% end %>

        <% if user_signed_in? %>
          <%= button_to "保存する",
              word_book_words_path(
                current_user.word_books.first,
                word: { term: entry[:word], meaning: entry[:meaning] }
              ),
              method: :post,
              class: "btn btn-sm btn-success mt-1" %>
        <% else %>
          <p class="text-muted">保存するにはログインしてください</p>
        <% end %>
      </li>
    <% end %>
  </ul>
<% elsif params[:term].present? %>
  <p>検索結果が見つかりませんでした。</p>
<% end %>

<hr>
<%= link_to "トップページに戻る", root_path, class: "btn btn-secondary mb-3" %>
